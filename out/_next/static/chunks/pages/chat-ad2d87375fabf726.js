(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180],{8916:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/chat",function(){return r(2035)}])},2035:function(e,t,r){"use strict";let s,i;r.r(t),r.d(t,{default:function(){return ey}});var o=r(5893),a=r(1163);let n="http://localhost:5000/api/chats",l=async e=>{let{token:t}=e,r=await fetch(n,{headers:{authorization:"Bearer ".concat(t)}}),s=await r.json();return s},c=async e=>{let{result:t,token:r}=e;try{let e=await fetch(n,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)},body:JSON.stringify({id:t._id})}),s=await e.json();if("bad request!"===s.message||"no id!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}};var d=r(7294),h=r(4065),u=r(6817),m=r(7001),x=r(7414),g=r(6155),j=r(9834),p=r(9236),f=r(5117),D=r(966),w=r(3723),C=r(1232),b=r(4991),y=r(8454),k=r(3991);let E="http://localhost:5000/api/messages",_=async e=>{let{request:t,token:r}=e;try{let e=await fetch("".concat(E,"/record"),{method:"POST",headers:{authorization:"Bearer ".concat(r)},body:t}),s=await e.json();if("empty fields!"===s.message)throw Error("يجب ارسال محتوي");if("bad request!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},v=async e=>{let{request:t,token:r}=e;try{if(""==t.content.trim())throw Error("يجب ارسال محتوي");let e=await fetch(E,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)},body:JSON.stringify(t)}),s=await e.json();if("empty fields!"===s.message)throw Error("يجب ارسال محتوي");if("bad request!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},z=async e=>{let{request:t,token:r}=e;try{let e=await fetch("".concat(E,"/").concat(t._id),{headers:{authorization:"Bearer ".concat(r)}}),s=await e.json();if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}};var S=r(9367),F=["\uD83D\uDE00","\uD83D\uDE04","\uD83D\uDE01","\uD83D\uDE06","\uD83D\uDE05","\uD83E\uDD23","\uD83D\uDE02","\uD83D\uDE42","\uD83D\uDE43","\uD83D\uDE09","\uD83D\uDE0A","\uD83D\uDE07","\uD83D\uDE0D","\uD83E\uDD29","\uD83D\uDE18","\uD83D\uDE17","☺️","\uD83D\uDE1A","\uD83D\uDE19","\uD83D\uDE0B","\uD83D\uDE1B","\uD83D\uDE1C","\uD83E\uDD2A","\uD83D\uDE1D","\uD83E\uDD11","\uD83E\uDD17","\uD83E\uDD2D","\uD83E\uDD2B","\uD83E\uDD14","\uD83E\uDD10","\uD83E\uDD28","\uD83D\uDE10","\uD83D\uDE11","\uD83D\uDE36","\uD83D\uDE36‍\uD83C\uDF2B️","\uD83D\uDE0F","\uD83D\uDE12","\uD83D\uDE44","\uD83D\uDE2C","\uD83D\uDE0C","\uD83D\uDE14","\uD83D\uDE2A"],N=r(1017),T=r(9759),P=r(9485),A=r(4017),O=r(6972),B=r(8090),Z=r(2870),I=r(8002);let R=()=>{let e=(0,a.useRouter)(),[t,r]=(0,d.useState)(!1),{user:s,setUser:i,setChats:n,setSelectedChat:l}=(0,A.g)(),{colorScheme:c,toggleColorScheme:h}=(0,O.X)(),u=()=>{e.push("/"),localStorage.removeItem("userInfo"),localStorage.removeItem("token"),i(null),n([]),l(null)};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(B.u,{opened:t,onClose:()=>r(!1),withCloseButton:!1,sx:{textAlign:"center"},children:[(0,o.jsx)(Z.E,{src:null==s?void 0:s.pic,mx:"auto",mb:"md",width:100,height:100}),(0,o.jsx)(f.x,{children:null==s?void 0:s.name}),(0,o.jsx)(f.x,{children:null==s?void 0:s.email})]}),(0,o.jsxs)(I.v,{children:[(0,o.jsx)(I.v.Target,{children:(0,o.jsx)(j.A,{children:(0,o.jsx)(k.kHX,{})})}),(0,o.jsxs)(I.v.Dropdown,{children:[(0,o.jsx)(I.v.Item,{icon:(0,o.jsx)(k.WkB,{stroke:1.4,size:14}),onClick:()=>r(!0),children:"الملف الشخصي"}),(0,o.jsx)(I.v.Item,{icon:"dark"===c?(0,o.jsx)(k.O31,{stroke:1.4,size:14}):(0,o.jsx)(k.zG9,{stroke:1.4,size:14}),onClick:()=>h(),children:"المظهر"}),(0,o.jsx)(I.v.Item,{icon:(0,o.jsx)(k.gtU,{stroke:1.4,size:14}),onClick:u,children:"تسجيل خروج"})]})]})]})};var q=r(9985);let L=(0,u.k)(e=>({box:{overflow:"hidden",cursor:"pointer",borderRadius:8,"&:hover":{background:"dark"===e.colorScheme?"#2C2E33":"#F1F3F5"}},selectedBox:{overflow:"hidden",cursor:"pointer",borderRadius:8,background:e.colors.Primary[0],color:"#FFF"},unseen:{borderRadius:"50%",background:e.colors.red[8],color:"#FFF",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center"}})),J=e=>{let{chats:t}=e,{classes:r}=L(),{user:s,setSelectedChat:i,selectedChat:a,notifications:n,setNotifications:l,activeUsers:c}=(0,A.g)(),d=e=>{let t=[];return n.length>0&&n.forEach(r=>{r.chat._id==e._id&&t.push(r)}),t},h=e=>{let t;return n.length>0&&n.forEach(r=>{t=r.chat._id==e._id?r:null}),t},u=e=>{if(e)return e.record?(0,o.jsx)(k.blY,{stroke:1,size:15}):e.content},m=e=>{var t,r;return e.multi?h(e)?e.sender._id==s._id?"انت":h(e).sender.name:(null===(t=e.latest)||void 0===t?void 0:t.sender._id)==s._id?"انت":null===(r=e.latest)||void 0===r?void 0:r.sender.name:null},j=e=>{let t=n.filter(t=>t.chat._id!=e._id);l(t)},p=e=>{i(e),j(e)},D=t.map(e=>(0,o.jsx)(x.x,{my:5,className:(null==a?void 0:a._id)===e._id?r.selectedBox:r.box,p:7,onClick:()=>p(e),children:(0,o.jsxs)(C.Z,{position:"apart",children:[(0,o.jsxs)(C.Z,{children:[e.multi?(0,o.jsx)(q.q,{radius:"xl",size:"lg",src:"https://icon-library.com/images/group-icon-png/group-icon-png-1.jpg"}):(0,o.jsx)(g.z,{dot:!0,inline:!0,position:"bottom-start",disabled:!c.includes(e.users.find(e=>e._id!=s._id)._id),offset:7,styles:{indicator:{background:"#1dd1a1"}},children:(0,o.jsx)(q.q,{radius:"xl",size:"lg",src:e.users.find(e=>e._id!=s._id).pic})}),(0,o.jsxs)(x.x,{sx:{width:"calc(100% - 80px) !important"},children:[(0,o.jsx)(f.x,{fw:"bold",mb:1,children:e.multi?e.name:e.users.find(e=>e._id!=s._id).name}),(null==a?void 0:a._id)!=e._id&&(0,o.jsx)(C.Z,{children:(0,o.jsxs)(f.x,{color:"dimmed",fz:"sm",lineClamp:1,sx:{width:140},children:[m(e)&&(0,o.jsxs)(f.x,{color:"dimmed",mr:3,fw:"bold",display:"inline",fz:"sm",children:[m(e),":"]}),h(e)?u(h(e)):u(e.latest)]})})]})]}),d(e).length>0&&(0,o.jsx)(x.x,{className:r.unseen,pt:3,pl:1,children:d(e).length})]})},e._id));return D};var U=r(4922);let W=(0,u.k)(e=>({box:{cursor:"pointer",borderRadius:8,"&:hover":{background:"dark"===e.colorScheme?"#2C2E33":"#F1F3F5"}}})),X=e=>{let{searchResult:t,triggerChats:r}=e,{classes:s}=W(),{user:i,chats:a,setSelectedChat:n}=(0,A.g)(),l=async e=>{if(!(null==e?void 0:e._id))return(0,U.c0)({id:"access-chat",color:"red",title:"فشل",message:"يجب اختيار شخص لبدأ المحادثة",icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3});let t=a.find(t=>!1==t.multi&&t.users.find(t=>t._id===e._id));if(t)return n(t);(0,U.c0)({id:"access-chat-".concat(e._id),loading:!0,title:"جاري ارسال البينات",message:"سيتم إضافة ".concat(e.name," الي المحادثات"),autoClose:!1,disallowClose:!0}),c({result:e,token:i.token}).then(t=>{r(),(0,U.wD)({id:"access-chat-".concat(e._id),color:"teal",title:"تم",message:"لقد تم إضافة ".concat(e.name," إلي المحادثات"),icon:(0,o.jsx)(k.NOm,{size:16}),autoClose:3e3})}).catch(t=>{(0,U.wD)({id:"access-chat-".concat(e._id),color:"red",title:"فشل",message:"".concat(t.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})},d=t.map(e=>(0,o.jsx)(x.x,{my:5,className:s.box,p:7,onClick:()=>l(e),children:(0,o.jsx)(C.Z,{position:"apart",children:(0,o.jsxs)(C.Z,{children:[(0,o.jsx)(q.q,{radius:"xl",size:"lg",src:e.pic}),(0,o.jsxs)(x.x,{children:[(0,o.jsx)(f.x,{fw:"bold",mb:1,lineClamp:1,children:e.name}),(0,o.jsx)(f.x,{fz:"sm",lineClamp:1,children:e.email})]})]})})},e._id));return d};var H=r(7789),K=r(7841);let V="http://localhost:5000/api/chats/group",M=async e=>{let{request:t,token:r}=e;try{let e=await fetch(V,{method:"POST",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)},body:JSON.stringify(t)}),s=await e.json();if("empty fields!"===s.message)throw Error("يجب إدخال اسم المجموعة والأعضاء");if("less than 2!"===s.message)throw Error("عدد الأعضاء يجب ان لا يقل عن عضوين");if("bad request!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},Y=async e=>{let{request:t,token:r}=e;try{let e=await fetch(V,{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)},body:JSON.stringify(t)}),s=await e.json();if("empty fields!"===s.message)throw Error("يجب إدخال اسم المجموعة");if("bad request!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},G=async e=>{let{request:t,token:r}=e;try{let e=await fetch("".concat(V,"/add"),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)},body:JSON.stringify(t)}),s=await e.json();if("already exist!"===s.message)throw Error("العضو بالفعل في المجموعة");if("bad request!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},Q=async e=>{let{request:t,token:r}=e;try{let e=await fetch("".concat(V,"/remove"),{method:"PATCH",headers:{"Content-Type":"application/json",authorization:"Bearer ".concat(r)},body:JSON.stringify(t)}),s=await e.json();if("less than 2!"===s.message)throw Error("المجموعة يجب ان لا تقل عن عضوين وانت");if("not found!"===s.message)throw Error("يجب تحديد العضو");if("bad request!"===s.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if("admin remove!"===s.message)throw Error("لا يمكن حذف مدير المجموعة");if(200===e.status)return s;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}};var $=r(8903),ee=r(368);let et=(0,u.k)(e=>({box:{cursor:"pointer",borderRadius:8,"&:hover":{background:"dark"===e.colorScheme?"#2C2E33":"#F1F3F5"}},loaderContainer:{height:300,display:"flex",alignItems:"center",justifyContent:"center"}})),er=e=>{let{triggerChats:t}=e,{classes:r}=et(),[s,i]=(0,d.useState)(!1),[a,n]=(0,d.useState)(""),[l]=(0,T.c)(a,200),[c,h]=(0,d.useState)([]),[u,m]=(0,d.useState)(!1),[g,p]=(0,d.useState)([]),[y,E]=(0,d.useState)(!1),{user:_,setSelectedChat:v}=(0,A.g)(),z=(0,$.c)({initialValues:{name:""},validate:{name:(0,ee.d)({min:3,max:10},"اسم المجموعة يجب ان يتكون من 3 الي 10 احرف")}}),S=()=>{i(!1),z.reset(),h([]),p([]),n(""),E(!1)},F=e=>{let r={name:e.name,users:g};g.length<2||(S(),(0,U.c0)({id:"create-group",loading:!0,title:"جاري ارسال البينات",message:"سيتم إرسال بيانات المجموعة",autoClose:!1,disallowClose:!0}),M({request:r,token:_.token}).then(e=>{t(),v(e),(0,U.wD)({id:"create-group",color:"teal",title:"تم",message:"لقد تم إنشاء المجموعة بنجاح",icon:(0,o.jsx)(k.NOm,{size:16}),autoClose:3e3})}).catch(e=>{(0,U.wD)({id:"create-group",color:"red",title:"فشل",message:"".concat(e.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})}))},N=()=>{g.length<2?E(!0):E(!1)},O=()=>{S(),i(!1)},Z=e=>{let t=g.find(t=>t._id===e._id);t||p([...g,e])},I=e=>{let t=g.filter(t=>t._id!==e._id);p(t),h([e,...c])},R=e=>{let t=[];e.forEach(e=>{let r=g.find(t=>t._id===e._id);r||t.push(e)}),h(t)};(0,d.useEffect)(()=>{R(c)},[g]),(0,d.useEffect)(()=>{""!==a.trim()?(h([]),m(!0),(0,P.jK)({search:a,token:_.token}).then(e=>{m(!1),R(e)})):(m(!1),h([]))},[l]);let L=g.map(e=>(0,o.jsx)(H.C,{sx:{paddingLeft:0},size:"lg",radius:"xl",color:"Primary.0",variant:"outline",rightSection:(0,o.jsx)(j.A,{size:"xs",color:"Primary.0",radius:"xl",variant:"transparent",onClick:()=>I(e),children:(0,o.jsx)(k.kLi,{size:10})}),leftSection:(0,o.jsx)(q.q,{size:26,mr:5,src:e.pic}),children:e.name},e._id)),J=c.map(e=>(0,o.jsx)(x.x,{my:5,className:r.box,p:7,onClick:()=>Z(e),children:(0,o.jsx)(C.Z,{position:"apart",children:(0,o.jsxs)(C.Z,{children:[(0,o.jsx)(q.q,{radius:"xl",size:"lg",src:e.pic}),(0,o.jsxs)(x.x,{children:[(0,o.jsx)(f.x,{fw:"bold",mb:1,lineClamp:1,children:e.name}),(0,o.jsx)(f.x,{fz:"sm",lineClamp:1,children:e.email})]})]})})},e._id));return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(B.u,{opened:s,onClose:()=>i(!1),withCloseButton:!1,children:(0,o.jsxs)("form",{onSubmit:z.onSubmit(e=>F(e)),children:[(0,o.jsx)(b.o,{mb:"md",autoComplete:"off",label:"اسم المجموعة",...z.getInputProps("name")}),(0,o.jsx)(b.o,{label:"الاعضاء",autoComplete:"off",value:a,onChange:e=>n(e.currentTarget.value),error:y?"يجب اختيار عضوين علي الأقل":null}),g.length>0&&(0,o.jsx)(C.Z,{my:"sm",children:L}),u&&(0,o.jsx)(x.x,{className:r.loaderContainer,children:(0,o.jsx)(D.a,{color:"Primary.0",size:"sm"})}),c.length>0&&(0,o.jsx)(w.x,{style:{height:300},scrollbarSize:5,children:J}),(0,o.jsxs)(C.Z,{position:"right",mt:"md",children:[(0,o.jsx)(K.z,{variant:"default",onClick:O,children:"إلغاء"}),(0,o.jsx)(K.z,{type:"submit",color:"Primary.0",onClick:N,children:"حفظ"})]})]})}),(0,o.jsx)(j.A,{onClick:()=>i(!0),children:(0,o.jsx)(k.SC9,{})})]})};var es=r(8623);let ei=()=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(C.Z,{my:5,p:7,children:[(0,o.jsx)(es.O,{width:50,height:50,radius:"50%"}),(0,o.jsxs)(x.x,{children:[(0,o.jsx)(es.O,{height:15,mb:10,radius:"md",width:100}),(0,o.jsx)(es.O,{height:10,radius:"md",width:150})]})]}),(0,o.jsxs)(C.Z,{my:5,p:7,children:[(0,o.jsx)(es.O,{width:50,height:50,radius:"50%"}),(0,o.jsxs)(x.x,{children:[(0,o.jsx)(es.O,{height:15,mb:10,radius:"md",width:100}),(0,o.jsx)(es.O,{height:10,radius:"md",width:150})]})]})]}),eo="25%",ea=(0,u.k)(e=>({card:{borderRadius:0,height:"100vh",zIndex:2,position:"relative",backgroundColor:"dark"===e.colorScheme?"#1A1B1E":"#FFF",borderRight:"1px solid",borderColor:"dark"===e.colorScheme?"#444":"#DDD"},searchList:{height:300,borderBottom:"1px solid",borderColor:"dark"===e.colorScheme?"#444":"#DDD"},searchLoaderContainer:{height:300,borderBottom:"1px solid",borderColor:"dark"===e.colorScheme?"#444":"#DDD",display:"flex",alignItems:"center",justifyContent:"center"}})),en=e=>{let{setOpened:t,opened:r,chatsLoader:s,triggerChats:i}=e,{classes:a}=ea(),{user:n,chats:l}=(0,A.g)(),[c,u]=(0,d.useState)(""),[m]=(0,T.c)(c,200),[g,f]=(0,d.useState)([]),[y,E]=(0,d.useState)(!1),_=(0,h.a)("(min-width: 992px)");return eo=_?"25%":"100vw",(0,d.useEffect)(()=>{""!==c.trim()?(f([]),E(!0),(0,P.jK)({search:c,token:n.token}).then(e=>{E(!1),f(e)})):(f([]),E(!1))},[m]),(0,d.useEffect)(()=>{n&&i()},[]),(0,o.jsxs)(N.Z,{className:a.card,px:5,sx:{width:eo},children:[(0,o.jsxs)(C.Z,{position:"apart",mb:"xs",children:[(0,o.jsxs)(C.Z,{children:[!_&&(0,o.jsx)(j.A,{onClick:()=>t(!1),children:(0,o.jsx)(k.kLi,{})}),(0,o.jsx)(p.D,{order:2,mt:10,children:"المحادثات"})]}),(0,o.jsxs)(C.Z,{children:[(0,o.jsx)(er,{triggerChats:i}),(0,o.jsx)(R,{})]})]}),(0,o.jsx)(b.o,{variant:"filled",autoComplete:"off",placeholder:"البحث...",className:a.search,value:c,onChange:e=>u(e.currentTarget.value),radius:8,rightSection:(0,o.jsx)(k.jVj,{size:16})}),y&&(0,o.jsx)(x.x,{className:a.searchLoaderContainer,children:(0,o.jsx)(D.a,{color:"Primary.0",size:"sm"})}),g.length>0&&(0,o.jsx)(x.x,{className:a.searchList,children:(0,o.jsx)(w.x,{style:{height:"100%"},scrollbarSize:5,children:(0,o.jsx)(X,{searchResult:g,triggerChats:i})})}),l.length>0&&(0,o.jsx)(w.x,{scrollbarSize:5,style:{height:g.length>0||y?"calc(100% - 375px)":"calc(100% - 75px)"},children:(0,o.jsx)(J,{chats:l})}),s&&(0,o.jsx)(ei,{})]})};var el=r(6180),ec=r(381),ed=r.n(ec);let eh=(0,u.k)(e=>({rightContainer:{justifyContent:"start"},leftContainer:{justifyContent:"end"},recordRight:{height:43,fill:"#FFF !important"},recordLeft:{height:43,fill:"".concat(e.colors.Primary[0],"!important")},rightText:{fill:"#FFF",wordWrap:"break-word",backgroundColor:e.colors.Primary[0],borderRadius:8,position:"relative",color:"#FFF",maxWidth:300,[e.fn.smallerThan("xs")]:{maxWidth:220}},leftText:{fill:"dark"===e.colorScheme?"#DDD":"#333",wordWrap:"break-word",background:"dark"===e.colorScheme?"#2C2E33":"#F1F3F5",borderRadius:8,position:"relative",color:"dark"===e.colorScheme?"#DDD":"#333",maxWidth:300,[e.fn.smallerThan("xs")]:{maxWidth:220}},rightArrow:{width:10,height:10,background:"".concat(e.colors.Primary[0]," !important"),position:"absolute",transform:"rotate(-20deg)",bottom:3,left:-1},leftArrow:{width:10,height:10,background:"dark"===e.colorScheme?"#2C2E33":"#F1F3F5",position:"absolute",transform:"rotate(20deg)",bottom:3,right:-1},rightTime:{float:"right"},leftTime:{float:"right"}})),eu=e=>{let{messages:t}=e,{classes:r}=eh(),{user:s,selectedChat:i}=(0,A.g)(),a=(e,r)=>e<t.length-1&&t[e+1].sender._id!==r.sender._id,n=e=>e===t.length-1,l=e=>{let{message:t,i:s}=e;return(0,o.jsxs)(C.Z,{align:"end",mb:a(s,t)||n(s)?"sm":2,className:r.rightContainer,children:[(a(s,t)||n(s))&&(0,o.jsx)(q.q,{radius:"xl",size:"md",src:t.sender.pic}),(0,o.jsxs)(x.x,{className:r.rightText,px:"md",pb:0,pt:2,ml:a(s,t)||n(s)?0:55,children:[(a(s,t)||n(s))&&(0,o.jsx)("div",{className:r.rightArrow}),i.multi&&(0,o.jsx)(f.x,{fz:"xs",color:"#DDD",fw:"bold",children:t.sender.name}),t.record?(0,o.jsx)(x.x,{className:r.recordRight,children:(0,o.jsx)(el.Z,{src:"data:audio/webm;base64,".concat(t.content)})}):(0,o.jsx)(f.x,{children:t.content}),(0,o.jsx)(f.x,{size:"sm",className:r.rightTime,italic:!0,color:"#DDD",children:"3:00 مساء"})]})]})},c=e=>{let{message:t,i:s}=e;return(0,o.jsx)(C.Z,{align:"end",mb:a(s,t)||n(s)?"sm":2,mr:8,className:r.leftContainer,children:(0,o.jsxs)(x.x,{className:r.leftText,px:"md",pb:0,pt:2,children:[(a(s,t)||n(s))&&(0,o.jsx)("div",{className:r.leftArrow}),t.record?(0,o.jsx)(x.x,{className:r.recordLeft,children:(0,o.jsx)(el.Z,{src:"data:audio/webm;base64,".concat(t.content)})}):(0,o.jsx)(f.x,{children:t.content}),(0,o.jsx)(f.x,{size:"sm",className:r.leftTime,italic:!0,color:"dimmed",children:ed()(t.createdAt).format("h:mm A")})]})})};return t.map((e,t)=>e.sender._id==s._id?(0,o.jsx)(c,{i:t,message:e},e._id):(0,o.jsx)(l,{i:t,message:e},e._id))},em=e=>{let{user:t,userModal:r,setUserModal:s}=e;return(0,o.jsxs)(B.u,{opened:r,onClose:()=>s(!1),withCloseButton:!1,sx:{textAlign:"center"},children:[(0,o.jsx)(Z.E,{src:t.pic,mx:"auto",mb:"md",width:100,height:100}),(0,o.jsx)(f.x,{children:t.name}),(0,o.jsx)(f.x,{children:t.email})]})},ex=e=>{let{groupViewer:t,setGroupViewer:r}=e,{user:s,selectedChat:i}=(0,A.g)(),[a,n]=(0,d.useState)(i.users),l=a.map(e=>(0,o.jsx)(H.C,{sx:{paddingLeft:0},size:"lg",radius:"xl",color:e._id===s._id?"green":"Primary.0",variant:"outline",leftSection:(0,o.jsx)(q.q,{size:24,mr:5,src:e.pic}),children:e._id===s._id?"انت":e.name},e._id));return(0,o.jsxs)(B.u,{opened:t,onClose:()=>r(!1),withCloseButton:!1,children:[(0,o.jsx)(f.x,{children:i.name}),(0,o.jsx)(C.Z,{my:"sm",children:l}),(0,o.jsx)(K.z,{variant:"default",onClick:()=>r(),fullWidth:!0,mt:"md",children:"إغلاق"})]})},eg=(0,u.k)(e=>({box:{cursor:"pointer",borderRadius:8,"&:hover":{background:"dark"===e.colorScheme?"#2C2E33":"#F1F3F5"}},loaderContainer:{height:300,display:"flex",alignItems:"center",justifyContent:"center"}})),ej=e=>{let{groupModal:t,setGroupModal:r,triggerChats:s}=e,{classes:i}=eg(),{user:a,setSelectedChat:n,selectedChat:l}=(0,A.g)(),[c,h]=(0,d.useState)(""),[u]=(0,T.c)(c,200),[m,g]=(0,d.useState)([]),[p,y]=(0,d.useState)(!1),[E,_]=(0,d.useState)(l.users),v=(0,$.c)({initialValues:{name:l.name},validate:{name:(0,ee.d)({min:3,max:10},"اسم المجموعة يجب ان يتكون من 3 الي 10 احرف")}}),z=()=>{r(!1),g([]),h("")},S=e=>{let t={name:e.name,id:l._id};(0,U.c0)({id:"rename-group",loading:!0,title:"جاري ارسال البينات",message:"سيتم إرسال بيانات المجموعة",autoClose:!1,disallowClose:!0}),Y({request:t,token:a.token}).then(e=>{s(),n(e),(0,U.wD)({id:"rename-group",color:"teal",title:"تم",message:"لقد تم تغيير إسم المجموعة بنجاح",icon:(0,o.jsx)(k.NOm,{size:16}),autoClose:3e3})}).catch(e=>{(0,U.wD)({id:"create-group",color:"red",title:"فشل",message:"".concat(e.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})},F=e=>{(0,U.c0)({id:"add-to-group-".concat(e._id),loading:!0,title:"جاري ارسال البينات",message:"سيتم إرسال بيانات إضافة العضو",autoClose:!1,disallowClose:!0}),G({request:{chat:l,user:e},token:a.token}).then(t=>{n(t),_([...E,e]),(0,U.wD)({id:"add-to-group-".concat(e._id),color:"teal",title:"تم",message:"لقد تم إضافة ".concat(e.name," بنجاح"),icon:(0,o.jsx)(k.NOm,{size:16}),autoClose:3e3})}).catch(t=>{(0,U.wD)({id:"add-to-group-".concat(e._id),color:"red",title:"فشل",message:"".concat(t.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})},N=e=>{(0,U.c0)({id:"remove-from-group-".concat(e._id),loading:!0,title:"جاري ارسال البينات",message:"سيتم إرسال بيانات حذف العضو",autoClose:!1,disallowClose:!0}),Q({request:{chat:l,user:e},token:a.token}).then(t=>{n(t);let r=E.filter(t=>t._id!==e._id);_(r),(0,U.wD)({id:"remove-from-group-".concat(e._id),color:"teal",title:"تم",message:"لقد تم حذف ".concat(e.name," بنجاح"),icon:(0,o.jsx)(k.NOm,{size:16}),autoClose:3e3})}).catch(t=>{(0,U.wD)({id:"remove-from-group-".concat(e._id),color:"red",title:"فشل",message:"".concat(t.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})},O=e=>{let t=[];e.forEach(e=>{let r=E.find(t=>t._id===e._id);r||t.push(e)}),g(t)};(0,d.useEffect)(()=>{O(m)},[E]),(0,d.useEffect)(()=>{""!==c.trim()?(g([]),y(!0),(0,P.jK)({search:c,token:a.token}).then(e=>{y(!1),O(e)})):(y(!1),g([]))},[u]);let Z=E.map(e=>(0,o.jsx)(H.C,{sx:{paddingLeft:0},size:"lg",radius:"xl",color:e._id===a._id?"red":"Primary.0",variant:"outline",rightSection:e._id!==a._id&&(0,o.jsx)(j.A,{size:"xs",color:"Primary.0",radius:"xl",variant:"transparent",onClick:()=>N(e),children:(0,o.jsx)(k.kLi,{size:10})}),leftSection:(0,o.jsx)(q.q,{size:24,mr:5,src:e.pic}),children:e._id===a._id?"انت":e.name},e._id)),I=m.map(e=>(0,o.jsx)(x.x,{my:5,className:i.box,p:7,onClick:()=>F(e),children:(0,o.jsx)(C.Z,{position:"apart",children:(0,o.jsxs)(C.Z,{children:[(0,o.jsx)(q.q,{radius:"xl",size:"lg",src:e.pic}),(0,o.jsxs)(x.x,{children:[(0,o.jsx)(f.x,{fw:"bold",mb:1,lineClamp:1,children:e.name}),(0,o.jsx)(f.x,{fz:"sm",lineClamp:1,children:e.email})]})]})})},e._id));return(0,o.jsx)(B.u,{opened:t,onClose:()=>r(!1),withCloseButton:!1,children:(0,o.jsxs)("form",{onSubmit:v.onSubmit(e=>S(e)),children:[(0,o.jsx)(b.o,{mb:"md",autoComplete:"off",label:"اسم المجموعة",rightSection:(0,o.jsx)(j.A,{type:"submit",children:(0,o.jsx)(k.TRY,{stroke:1.4})}),...v.getInputProps("name")}),(0,o.jsx)(b.o,{label:"الاعضاء",autoComplete:"off",placeholder:"إضافة عضو جديد",value:c,onChange:e=>h(e.currentTarget.value)}),E.length>0&&(0,o.jsx)(C.Z,{my:"sm",children:Z}),p&&(0,o.jsx)(x.x,{className:i.loaderContainer,children:(0,o.jsx)(D.a,{color:"Primary.0",size:"sm"})}),m.length>0&&(0,o.jsx)(w.x,{style:{height:300},scrollbarSize:5,children:I}),(0,o.jsx)(K.z,{variant:"default",onClick:z,fullWidth:!0,mt:"md",children:"إغلاق"})]})})};var ep=r(3079);let ef=(0,u.k)(e=>({navbar:{boxShadow:"0px 0px 10px 0px rgba(0, 0, 0, .25)",zIndex:1,position:"relative",height:70,display:"flex",alignItems:"center",justifyContent:"space-between"},placeholder:{height:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},main:{height:"calc(100vh - 125px)",overflow:"hidden"},rightText:{wordWrap:"break-word",backgroundColor:e.colors.Primary[0],borderRadius:8,position:"relative"},rightArrow:{width:10,height:10,background:e.colors.Primary[0],position:"absolute",transform:"rotate(-20deg)",bottom:3,left:-1},chatPlaceholder:{height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},footer:{backgroundColor:"dark"===e.colorScheme?"#1A1B1E":"#FFF",borderTop:"1px solid",borderColor:"dark"===e.colorScheme?"#444":"#DDD",height:55},input:{width:"calc(100% - 160px)"},previewContainer:{width:"calc(100% - 160px)",height:54,display:"flex",justifyContent:"center",alignItems:"center",fill:"dark"===e.colorScheme?"#DDD":"#333"},send:{transform:"rotateY(180deg)",color:"#FFF"}})),eD=e=>{let{setOpened:t,opened:r,chatsLoader:a,triggerChats:n}=e,{classes:l}=ef(),c=(0,h.a)("(min-width: 992px)"),{user:u,selectedChat:E,notifications:N,setNotifications:T,setSelectedChat:P,activeUsers:O,setActiveUsers:B}=(0,A.g)(),[Z,I]=(0,d.useState)(!1),[R,q]=(0,d.useState)(!1),[L,J]=(0,d.useState)(!1),W=(0,d.useRef)(null),X=(0,d.useRef)(null),[H,K]=(0,d.useState)([]),[V,M]=(0,d.useState)(!1),[Y,G]=(0,d.useState)(""),[Q,$]=(0,d.useState)(!1),[ee,et]=(0,d.useState)(!1),[er,es]=(0,d.useState)(!1),[ei,eo]=(0,d.useState)(!1),[ea,ec]=(0,d.useState)(!1),[ed,eh]=(0,d.useState)(!1),{startRecording:eg,stopRecording:eD,mediaBlobUrl:ew}=(0,ep.useReactMediaRecorder)({audio:!0,blobPropertyBag:{type:"audio/webm"}}),eC=()=>{er||(es(!0),s.emit("typing",E._id)),eg(),ec(!0),eh(!1)},eb=()=>{es(!1),s.emit("stop typing",E._id),eD(),ec(!1),eh(!0)},ey=()=>{ec(!1),eh(!1)},ek=()=>{M(!0),z({request:E,token:u.token}).then(e=>{M(!1),K(e),s.emit("join chat",E._id)}).catch(e=>{M(!1),(0,U.c0)({id:"err-get",color:"red",title:"فشل",message:"".concat(e.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})};(0,d.useEffect)(()=>{(s=(0,S.ZP)("http://localhost:5000")).emit("setup",u),s.on("connected",()=>et(!0)),s.on("broadcast",e=>{let t=e.filter(e=>e.c!=u._id),r=t.map(e=>e.c);B(r)}),s.on("stop typing",()=>eo(!1))},[]);let eE=async()=>{let e=await fetch(ew).then(e=>e.blob()),t=new File([e],"c.webm",{type:"audio/webm"}),r=new FormData;r.append("file",t),r.append("chat",E._id),s.emit("stop typing",E._id),G(""),$(!0),es(!1),_({request:r,token:u.token}).then(e=>{var t;eh(!1),$(!1),null===(t=W.current)||void 0===t||t.focus(),K([...H,e]),s.emit("new message",e)}).catch(e=>{$(!1),(0,U.c0)({id:"err-send",color:"red",title:"فشل",message:"".concat(e.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})},e_=()=>{let e={chatId:E._id,content:Y.trim()};s.emit("stop typing",E._id),G(""),$(!0),v({request:e,token:u.token}).then(e=>{var t;$(!1),null===(t=W.current)||void 0===t||t.focus(),K([...H,e]),s.emit("new message",e)}).catch(e=>{$(!1),(0,U.c0)({id:"err-send",color:"red",title:"فشل",message:"".concat(e.message),icon:(0,o.jsx)(k.Us8,{size:16}),autoClose:3e3})})},ev=()=>{(null==X?void 0:X.current)&&X.current.scrollTo({top:X.current.scrollHeight,behavior:"smooth"})};(0,d.useEffect)(()=>{if(E){var e;ek(),i=E,null===(e=W.current)||void 0===e||e.focus()}G("")},[E]),(0,d.useEffect)(()=>{E&&H.length>2&&ev(),(null==i?void 0:i._id)&&s.on("typing",e=>{e==i._id&&eo(!0)}),s.on("message recieved",e=>{i&&i._id==e.chat._id?K([...H,e]):N.includes(e)||T([e,...N])})}),(0,d.useEffect)(()=>{u||s.emit("logout")},[u]);let ez=e=>{G(e.currentTarget.value),ee&&(er||(es(!0),s.emit("typing",E._id),setTimeout(()=>{s.emit("stop typing",E._id),es(!1)},3e3)))},eS=()=>{t(!0),P(null)};return(0,o.jsxs)(o.Fragment,{children:[!c&&(0,o.jsx)(m.d,{opened:r,onClose:()=>t(!1),withOverlay:!1,withCloseButton:!1,children:(0,o.jsx)(en,{setOpened:t,opened:r,chatsLoader:a,triggerChats:n})}),E&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(x.x,{className:l.navbar,px:"md",children:[!c&&(0,o.jsx)(g.z,{color:"red",label:parseInt(N.length),overflowCount:9,size:18,showZero:!1,dot:!1,children:(0,o.jsx)(j.A,{onClick:eS,children:(0,o.jsx)(k.Ec8,{})})}),(0,o.jsx)(x.x,{children:E.multi?(0,o.jsx)(p.D,{order:3,mt:10,ml:"sm",children:E.name}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(p.D,{order:4,mt:10,ml:"sm",children:E.users.find(e=>e._id!=u._id).name}),O.includes(E.users.find(e=>e._id!=u._id)._id)&&(0,o.jsx)(f.x,{fz:"xs",ml:"sm",color:"dimmed",children:ei?"يكتب...":"متصل الآن"})]})}),E.multi&&E.admin._id==u._id&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ej,{groupModal:Z,setGroupModal:I,triggerChats:n},E._id),(0,o.jsx)(j.A,{onClick:()=>I(!0),children:(0,o.jsx)(k.kHX,{})})]}),E.multi&&E.admin._id!=u._id&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(ex,{groupViewer:R,setGroupViewer:q}),(0,o.jsx)(j.A,{onClick:()=>q(!0),children:(0,o.jsx)(k.kHX,{})})]}),!E.multi&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(em,{userModal:L,setUserModal:J,user:E.users.find(e=>e._id!=u._id)}),(0,o.jsx)(j.A,{onClick:()=>J(!0),children:(0,o.jsx)(k.kHX,{})})]})]}),(0,o.jsxs)(x.x,{className:l.main,children:[V&&(0,o.jsx)(x.x,{className:l.chatPlaceholder,children:(0,o.jsx)(D.a,{color:"Primary.0"})}),H.length>0&&(0,o.jsxs)(w.x,{style:{height:"100%"},viewportRef:X,px:1,scrollbarSize:5,children:[(0,o.jsx)(eu,{messages:H}),ei?(0,o.jsxs)(x.x,{className:l.rightText,display:"inline-block",px:"xs",pb:2,pt:0,ml:5,mb:5,children:[(0,o.jsx)("div",{className:l.rightArrow}),(0,o.jsx)(D.a,{variant:"dots",size:"sm",color:"#FFF"})]}):(0,o.jsx)(o.Fragment,{})]})]}),(0,o.jsx)(x.x,{className:l.footer,children:(0,o.jsxs)(C.Z,{children:[!ea&&!ed&&(0,o.jsx)(j.A,{ml:5,onClick:eC,disabled:Q,children:(0,o.jsx)(k.blY,{stroke:1.2,size:28,color:"#666"})}),ea&&(0,o.jsx)(j.A,{ml:5,onClick:eb,children:(0,o.jsx)(k.z8K,{stroke:1.2,size:28,color:"#666"})}),ed&&(0,o.jsx)(j.A,{ml:5,onClick:ey,children:(0,o.jsx)(k.IT9,{stroke:1.2,size:28,color:"#666"})}),ed?(0,o.jsx)(x.x,{className:l.previewContainer,children:(0,o.jsx)(el.Z,{src:"".concat(ew)})}):(0,o.jsx)(b.o,{styles:{input:{height:54,fontSize:16,color:"#555"}},className:l.input,disabled:Q,ref:W,autoComplete:"off",autoFocus:!0,type:"text",px:c?"md":0,placeholder:"اكتب شيئا هنا...",variant:"unstyled",value:Y,onKeyDown:e=>{"Enter"==e.code&&e_()},onChange:e=>ez(e)}),(0,o.jsx)(C.Z,{position:"center",children:(0,o.jsxs)(y.z,{width:285,shadow:"md",children:[(0,o.jsx)(y.z.Target,{children:(0,o.jsx)(j.A,{children:(0,o.jsx)(k.sX6,{stroke:1.2,size:28,color:"#666"})})}),(0,o.jsx)(y.z.Dropdown,{children:(0,o.jsx)(C.Z,{children:F.map((e,t)=>(0,o.jsx)(j.A,{onClick:()=>{var t;G("".concat(Y).concat(e," ")),null===(t=W.current)||void 0===t||t.focus()},children:(0,o.jsx)(f.x,{children:e})},t))})})]})}),ed?(0,o.jsx)(j.A,{radius:"xl",bg:"Primary.0",variant:"transparent",loading:Q,loaderProps:{color:"#FFF"},size:"xl",onClick:eE,children:(0,o.jsx)(k.BJe,{className:l.send,stroke:1,size:28})}):(0,o.jsx)(j.A,{radius:"xl",bg:"Primary.0",variant:"transparent",loading:Q,loaderProps:{color:"#FFF"},size:"xl",onClick:e_,children:ea?(0,o.jsx)(D.a,{size:"xs",variant:"bars",color:"#FFF"}):(0,o.jsx)(k.BJe,{className:l.send,stroke:1,size:28})})]})})]}),!E&&(0,o.jsxs)(x.x,{className:l.placeholder,children:[(0,o.jsx)(p.D,{color:"dimmed",order:c?2:3,children:"اختر محادثة لبدأ الدردشة"}),!c&&(0,o.jsx)(j.A,{onClick:()=>t(!0),variant:"filled",color:"Primary.0",mt:"xl",children:(0,o.jsx)(k.Ec8,{})})]})]})};var ew=r(3119);let eC=(0,u.k)(e=>({placeholder:{height:"100vh",display:"flex",justifyContent:"center",alignItems:"center"}})),eb=()=>{let e=(0,a.useRouter)(),{classes:t}=eC(),[r,s]=(0,d.useState)(!0),i=(0,h.a)("(min-width: 992px)"),[n,c]=(0,d.useState)(!1),{user:u,selectedChat:m,setChats:g}=(0,A.g)(),[j,p]=(0,d.useState)(!0),f=()=>{p(!0),g([]),l({token:u.token}).then(e=>{p(!1),g(e)})};return((0,d.useEffect)(()=>{!i&&m&&s(!1)},[m]),(0,d.useEffect)(()=>{let t=JSON.parse(localStorage.getItem("userInfo"));t?(c(!0),e.push("/chat")):(c(!1),e.push("/"))},[]),n)?(0,o.jsx)(ew.V,{navbar:i?(0,o.jsx)(en,{setOpened:s,opened:r,chatsLoader:j,triggerChats:f}):null,styles:{main:{padding:0}},children:(0,o.jsx)(eD,{setOpened:s,opened:r,chatsLoader:j,triggerChats:f})}):(0,o.jsx)(x.x,{className:t.placeholder,children:(0,o.jsx)(D.a,{variant:"dots",color:"Primary.0",size:"xl"})})};var ey=eb},9485:function(e,t,r){"use strict";r.d(t,{Xf:function(){return i},Yf:function(){return o},jK:function(){return a}});let s="http://localhost:5000/api/users",i=async e=>{let{request:t}=e;try{let e=await fetch("".concat(s,"/signin"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await e.json();if("empty fields!"===r.message)throw Error("يرجي ملئ البيانات");if("not found!"===r.message)throw Error("الحساب غير موجود");if(200===e.status)return r;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},o=async e=>{let{request:t}=e;try{let e=await fetch(s,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),r=await e.json();if("empty fields!"===r.message)throw Error("يرجي ملئ البيانات");if("user exists!"===r.message)throw Error("يرجي ادخال بريد اخر");if("creation failed!"===r.message)throw Error("حدث خطأ ما يرجي المحاولة مرة اخري");if(201===e.status)return r.message;throw Error("حدث خطأ ما يرجي المحاولة مرة اخري")}catch(e){throw Error(e.message)}},a=async e=>{let{search:t,token:r}=e,i=await fetch("".concat(s,"?search=").concat(t),{headers:{authorization:"Bearer ".concat(r)}}),o=await i.json();return o}}},function(e){e.O(0,[584,885,548,79,774,888,179],function(){return e(e.s=8916)}),_N_E=e.O()}]);